<div *ngIf="lb.dataSource as ds"
     class="pnd-sidebar"
     [ngClass]="{
        'is-collapsed': (ds.isCollapsed | async),
        'is-expanded': !(ds.isCollapsed | async),
        'has-notebook-panel-open': (lb.dataSource.notebookEditor | async)
    }">
    
    <!-- Pundit Logo toggle -->
    <div class="pundit-icon-pundit pnd-sidebar__logo"
         (click)="lb.eventHandler.emitInner('clicklogo')">
    </div>
    <!-- END // Pundit Logo toggle -->

    <!-- Header -->
    <div class="pnd-sidebar__header">
        <div class="pnd-sidebar__user-name">
            <ng-container *ngIf="!(ds.userService.logged$ | async)">
                <a (click)="lb.eventHandler.emitInner('requestlogin')"
                    class="pnd-sidebar__header-login">Login</a>
            </ng-container>
            <ng-container *ngIf="ds.userService.logged$ | async"> 
                <a (click)="lb.eventHandler.emitInner('clickusername')"
                   class="pnd-sidebar__user-name-link">
                    {{ ds.userService.whoami().username }}
                </a>
            </ng-container>
        </div>
        <div *ngIf="ds.userService.logged$ | async" class="pnd-sidebar__actions">
            <a class="pnd-sidebar__action pnd-sidebar__notebook-panel {{ (ds.notebookEditor | async) ? 'is-active' : ''}}"
               (click)="lb.eventHandler.emitInner('notebookpanel')">
                <span class="pundit-icon-book"></span>
            </a>
            <a class="pnd-sidebar__action pnd-sidebar__logout-button"
               (click)="lb.eventHandler.emitInner('clicklogout')">
                <span class="pundit-icon-signout"></span>
            </a>
            <a class="pnd-sidebar__action pnd-sidebar__close-button"
               (click)="lb.eventHandler.emitInner('sidebarclose')">
                <span class="pundit-icon-times"></span>
            </a>
        </div>
    </div>
    <!-- END // Header -->

    <!-- Notebook popover -->
    <ng-container *ngIf="lb.dataSource.notebookEditor.getValue()">
        <ng-container *ngTemplateOutlet="notebookpanel"></ng-container>
    </ng-container>
    <!-- END // Notebook popover -->

    <!-- Sidebar content -->
    <div class="pnd-sidebar__content"
         [style.height]="ds.height$ | async">
         <ng-container *ngFor="let annotation of lb.dataSource.annotations">
            <annotation [ngClass]="annotation"
                        [data]="annotation.ds.out$ | async"
                        [emit]="lb.widgets['annotation'].emit">
            </annotation>
        </ng-container>
    </div>
    <!-- END //Sidebar content -->
</div>


<ng-template #notebookpanel>
    <notebook-panel [data]="lb.widgets['notebook-panel'].ds.out$ | async"
                    [emit]="lb.widgets['notebook-panel'].emit"></notebook-panel>
</ng-template>
