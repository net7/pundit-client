<div *ngIf="lb.dataSource as ds"
     class="pundit-sidebar"
     [ngClass]="{
        'is-collapsed': (ds.isCollapsed | async),
        'is-expanded': !(ds.isCollapsed | async),
        'notebook-panel-open': (lb.dataSource.notebookEditor | async)
     }">

    <div class="n7-icon-pundit pundit-sidebar__logo"
         (click)="lb.eventHandler.emitInner('clicklogo')">
        <img [src]="logo"
             alt="pundit mock logo">
    </div>

    <div class="pundit-sidebar__user-row">
        <!-- pundit icon inside a circle -->
        <div class="n7-icon-pundit pundit-sidebar__logo"
             (click)="lb.eventHandler.emitInner('clicklogo')">
            <img [src]="logo"
                 alt="pundit mock logo">
        </div>
        <!-- user name -->
        <div class="pundit-sidebar__user-name">
            <ng-container *ngIf="!(ds.userService.logged$ | async)">
                <a (click)="lb.eventHandler.emitInner('requestlogin')">Login</a>
            </ng-container>
            <ng-container *ngIf="ds.userService.logged$ | async"> 
                <a (click)="lb.eventHandler.emitInner('clickusername')">
                    {{ ds.userService.whoami().username }}
                </a>
            </ng-container>
        </div>
        <div *ngIf="ds.userService.logged$ | async" class="pundit-sidebar__actions">
            <a class="pundit-sidebar__notebook-panel {{ (ds.notebookEditor | async) ? 'active' : ''}}"
               (click)="lb.eventHandler.emitInner('notebookpanel')">
                <a>
                    <span class="n7-icon-book pundit-sidebar__header-icon"></span>
                </a>
            </a>
            <a class="pundit-sidebar__logout-button"
               (click)="lb.eventHandler.emitInner('clicklogout')">
                <a>
                    <span class="n7-icon-share2 pundit-sidebar__header-icon"></span>
                </a>
            </a>
            <a class="pundit-sidebar__close-button"
               (click)="lb.eventHandler.emitInner('sidebarclose')">
                <a>
                    <span class="n7-icon-close pundit-sidebar__header-icon"></span>
                </a>
            </a>
        </div>
    </div>

    <!-- notebook selection / creation panel -->
    <ng-container *ngIf="lb.dataSource.notebookEditor.getValue()">
        <ng-container *ngTemplateOutlet="notebookpanel"></ng-container>
    </ng-container>


    <div class="pundit-sidebar__cont"
         [style.height]="ds.height$ | async">
        <div class="pundit-sidebar__annotation-column">
            <ng-container *ngFor="let annotation of lb.widgets['annotation'].ds.out$ | async">
                <annotation [ngClass]="annotation"
                            [data]="annotation"
                            [emit]="lb.widgets['annotation'].emit">
                </annotation>
            </ng-container>
        </div>
    </div>
</div>


<ng-template #notebookpanel>
    <notebook-panel [data]="lb.widgets['notebook-panel'].ds.out$ | async"
                    [emit]="lb.widgets['notebook-panel'].emit"></notebook-panel>
</ng-template>
